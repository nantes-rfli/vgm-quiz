# Product Requirements (Lean)
- Status: Approved
- Last Updated: 2025-09-19

## 1. Goal
**この章の目的：** プロダクトが“何を達成するか”（価値と体験のゴール）を1〜2文で明確化する。

- 初回訪問から数タップでゲーム音楽当てクイズを楽しめる“即プレイ体験”を提供する。音が確実に鳴り、初期値10問を軽快に遊べる。

## 2. Non-Goals（MVP）
**この章の目的：** 今フェーズでは“やらないこと”を明示し、スコープ肥大と期待のズレを防ぐ。

- 認証／アカウント作成、およびサーバー保存のランキングは対象外（ローカルスコアのみ）。
- クイズ進行中の外部ストリーミング再生は行わない。結果表示時のみ公式視聴先へ案内（リンク優先／設定で公式埋め込み可）。音源の自前ホスト・配布やダダウンロード提供は行わない。
- 高度なチート対策やサーバー側不正検知基盤は対象外（MVPは最小限の検証のみ）。
- 静的エクスポートを基本とし、SSRや常時稼働のバックエンドを前提にしない（必要最小限のモックAPIに限定）。
- 広告および課金導線の実装は対象外。

## 3. Target & Constraints
**この章の目的：** 想定ユーザー・環境と制約（性能/法務/運用）を定義し、後続の設計判断の前提を固定する。

- 対象：モバイル優先（iOS/Android 最新2メジャー）、縦持ち片手操作を前提
- ブラウザ：Safari/Chrome/Edgeの現行安定版
- ネットワーク：4G相当で快適、3G/高遅延時は待機UI/スキップ導線
- アクセシビリティ：フォーカス可視・コントラスト比 WCAG AA 目安
- 配信/法務：クイズ進行中の外部ストリーミング再生は行わない。結果表示（各問の結果/最終結果）に限り、公式視聴先へのリンクまたは公式プレーヤー埋め込みで紹介（自動再生禁止・UI非改変）。埋め込み不可/地域制限時は即リンクへフォールバック。
- 技術前提：静的エクスポート（CSR中心）。FunctionsはモックAPI最小限
- パフォーマンス：LCP ≤ 2.5s（P75, モバイル）/ 初回JS（gzip）≤ 150KB 目安
- データ/プライバシー：PIIを収集しない。保存はローカルストレージのみ
- コスト：無料/低コスト枠を上限、常時稼働サーバーなし

## 4. MVP Scope
**この章の目的：** MVPでユーザーが実際に体験できる範囲とルールを、簡潔な“約束事”として定義する（数値の微調整や実装詳細は設計・品質ドキュメントに委ねる）。

- **問数**：既定10問（UIでの切替なし）。将来的な検証に向け、実装上は5/20へ変更可能。
- **出題**：各問4択・制限時間15秒。タイムアウトは不正解。
- **採点**：正解時は **基礎点100 + 残秒×5**。連続正解ボーナスはMVPではOFF。
- **スキップ**：ユーザースキップ＝不正解。重大なデータ欠損等で設問が無効の場合は**システムスキップ**としてバックアップ問題に差し替え（総問数は維持）。
- **再生**：クイズ中は外部ストリーミング再生を行わない。各問の結果カードで**視聴リンク**（既定）を表示し、**ユーザー設定で“インライン再生ON”**の場合のみ**公式プレーヤー埋め込み**を表示（自動再生なし）。埋め込み失敗/地域制限時は**即リンクへフォールバック**。
- **画面**：`/`（スタート/遊び方）、`/play`（出題/回答）、`/result`（結果）、`/about`（出典・注意書き）。各問の **結果カード（Question Reveal Card）** で視聴先を紹介する。
- **操作**：タップ中心＋ショートカット **Space / 1–4 / Enter / M（ミュート）**。
- **保存**：スコア/設定はローカルのみ（サーバー永続なし）。
- **計測**：PIIなし・短期セッションID。`answer_select`、`answer_result`、`quiz_complete` を送信。結果紹介に関するイベント（例：`reveal_open_external`、`embed_impression`、`embed_play`、`embed_error`、`embed_fallback_to_link`。

## 5. Primary User Stories
**この章の目的：** MVPで“必ず成立させるユーザー体験”をユーザー視点で列挙し、受け入れ基準やE2Eの親とする。

- **U1: 即プレイ開始**
  初回アクセス後、1回の操作ですぐに出題が始められる（クイズ中は外部音源の再生なし）。
- **U2: 自動フォールバックで継続**
  結果の紹介で埋め込みが失敗してもリンクへ自動フォールバックし、進行が止まらない。
- **U3: テンポ良く回答→次へ**
  回答すると即時に正誤がわかり、制限時間15秒の中でテンポ良く次の問題へ進める（タイムアウトは不正解）。
- **U4: 完走と結果の把握**
  10問を完走し、合計スコア・正解数・各問の残秒と正誤を結果画面で確認できる。
- **U5: スキップの扱いが明確**
  ユーザースキップは不正解として扱い、全候補で再生不可の設問は無効化してバックアップ問題に自動差し替え（総問数は維持）。

## 6. Success Metrics
**この章の目的：** MVPが“成功した”と言える基準をカテゴリで定義し、合否（Hard Gate）と監視（Monitor）の扱いを明確化する。  
*TTRP = 回答確定からプレーヤーが再生可能になるまでの時間（設定でインライン再生ON時のみ計測）。*

- 体感速度（Hard Gate）：LCP（モバイルP75）
- 紹介導線（Monitor）：Outbound Click Rate（結果画面での視聴リンククリック率）
- 埋め込み体験（Monitor）：TTRP（回答確定→プレーヤーReadyのP75）／Embed Play Success Rate（設定ON時のみ評価）
- フォールバック（Monitor）：Embed Fallback Rate（埋め込み失敗→リンク切替の割合）
- ゲーム達成（Hard Gate）：Completion Rate（結果画面到達率）
- しきい値はMVP公開時の実測に基づき設定し、一定期間後に見直す

## 7. Risks & Mitigations
**この章の目的：** MVPの失敗に直結する主要リスクを列挙し、6章の指標に基づく検知とMVPでの対策/回避を簡潔に定める（数値や運用詳細は別ドキュメントに委ねる）。

- **R1: 結果紹介の埋め込み失敗（地域/ブロック/自動再生制限）** — 検知：`embed_error`／`embed_fallback_to_link` の増加。対策/回避：既定はリンク、設定ON時のみ埋め込み、エラー時は即リンク切替＋UIで明示。
- **R2: 体感速度の悪化（LCP/TTFS）** — 検知：LCP（モバイルP75）>2.5s・TTFS悪化。対策/回避：初回JS（gzip）**≤150KB**・遅延ロード・最適化、必要時**軽量モード**。
- **R3: 問題プールの陳腐化/リンク切れ** — 検知：Fallback Occurrence上振れ・差替率増。対策/回避：**バックアップ問題同梱**＋リンク健全性チェック／埋め込み可否チェック、影響セット一時停止→代替差替。
- **R4: 端末/ブラウザ差による音出し不可** — 検知：端末別Playback Start Rateの偏り。対策/回避：**明示的再生ボタン＋初回ガイダンス**・gesture順守・リトライ、`/play`からヘルプへ即遷移。
- **R5: 計測欠損（オフライン/ブロック/送信失敗）** — 検知：イベント到達率・セッション整合の下振れ。対策/回避：**ローカルキュー再送**・最小イベント送信・PII不収集、計測不能でもプレイ継続。
- **R6: 法務/配信規約の不整合・仕様変更** — 検知：エラー/HTTP 4xx増・外部通報。対策/回避：対策/回避：**結果表示での紹介に限定**、**公式UI準拠（自動再生禁止・UI非改変）**、禁止事項の明記、問題発生プロバイダの即時停止→代替誘導。

## 8. Open Questions
**この章の目的：** 現時点で未確定の意思決定事項を列挙し、次の合意形成に向けた論点を明確化する。

- **Q1: 計測の送信手段・頻度・再送条件** — navigator.sendBeacon / fetch / バッチ化の採用有無、送信タイミングと失敗時の再送ルール。
- **Q2: バックアップ問題の同梱比率と更新フロー** — 既定10問に対し何問をバックアップとして保持するか、差し替え時の運用。
- **Q3: 法務文言の最終形** — 出典表記・クレジット・免責・地域/年齢注意の文面と掲出場所。
- **Q4: 問題/音源データのスキーマ** — `reveal.links`（provider/label/url）の最小集合、`embedPreferredProvider` の扱い、`artwork`（外部参照/ライセンス/プロキシ）の要否。
- **Q5: プロバイダの許可/埋め込み方針** — 既定はリンク、設定ON時のみ埋め込み。allowlist（例：YouTube/Apple Music）の管理と地域制限時の代替導線。
- **Q6: 結果画面の表示項目の確定** — 合計スコア/正解数/各問残秒/正誤の表示範囲、共有導線の有無と仕様。
