# Product Requirements (Lean)
- Status: Approved
- Last Updated: 2025-09-16

## 1. Goal
- 初回訪問から数タップでゲーム音楽当てクイズを楽しめる“即プレイ体験”を提供する。音が確実に鳴り、初期値10問を軽快に遊べる。

## 2. Non-Goals（MVP）
- 認証／アカウント作成、およびサーバー保存のランキングは対象外（ローカルスコアのみ）。
- 音源の自前ホスト・配布やダウンロード提供は行わない（外部の合法配信を埋め込みのみで利用）。
- 高度なチート対策やサーバー側不正検知基盤は対象外（MVPは最小限の検証のみ）。
- 静的エクスポートを基本とし、SSRや常時稼働のバックエンドを前提にしない（必要最小限のモックAPIに限定）。
- 広告および課金導線の実装は対象外。

## 3. Target & Constraints
- 対象：モバイル優先（iOS/Android 最新2メジャー）、縦持ち片手操作を前提
- ブラウザ：Safari/Chrome/Edgeの現行安定版
- ネットワーク：4G相当で快適、3G/高遅延時は待機UI/スキップ導線
- アクセシビリティ：フォーカス可視・コントラスト比 WCAG AA 目安
- 配信/法務：外部の合法配信を埋め込みのみ。ダウンロード/自前ホストなし
- 技術前提：静的エクスポート（CSR中心）。FunctionsはモックAPI最小限
- パフォーマンス：LCP ≤ 2.5s（P75, モバイル）/ 初回JS（gzip）≤ 150KB 目安
- データ/プライバシー：PIIを収集しない。保存はローカルストレージのみ
- コスト：無料/低コスト枠を上限、常時稼働サーバーなし

## 4. MVP Scope
**この章の目的：** MVPでユーザーが実際に体験できる範囲とルールを、簡潔な“約束事”として定義する（数値の微調整や実装詳細は設計・品質ドキュメントに委ねる）。

- **問数**：既定10問（UIでの切替なし）。将来的な検証に向け、実装上は5/20へ変更可能。
- **出題**：各問4択・制限時間15秒。タイムアウトは不正解。
- **採点**：正解時は **基礎点100 + 残秒×5**。連続正解ボーナスはMVPではOFF。
- **スキップ**：ユーザースキップ＝不正解。全候補で再生不可なら**システムスキップ**として無効化し、バックアップ問題に差し替え（総問数は維持）。
- **再生**：外部の合法配信を埋め込み再生。初回は**ユーザー操作起点**。各設問は**再生ソース候補を優先度順**に保持し、上位から試行→失敗時のみフォールバック。
- **画面**：`/`（スタート/遊び方）、`/play`（出題/回答）、`/result`（結果）、`/about`（出典・注意書き）。
- **操作**：タップ中心＋ショートカット **Space / 1–4 / Enter / M（ミュート）**。
- **保存**：スコア/設定はローカルのみ（サーバー永続なし）。
- **計測**：PIIなし・短期セッションID。`play_start`（TTFS含む）、`answer_select`、`answer_result`、`quiz_complete` を送信。

## 5. Primary User Stories
- **U1: 即プレイ開始**  
  初回アクセス後、1回の操作で音が鳴り、すぐに出題が始められる。
- **U2: 自動フォールバックで継続**  
  再生に失敗しても自動フォールバックで進行が止まらない。
- **U3: テンポ良く回答→次へ**  
  回答すると即時に正誤がわかり、制限時間15秒の中でテンポ良く次の問題へ進める（タイムアウトは不正解）。
- **U4: 完走と結果の把握**  
  10問を完走し、合計スコア・正解数・各問の残秒と正誤を結果画面で確認できる。
- **U5: スキップの扱いが明確**  
  ユーザースキップは不正解として扱い、全候補で再生不可の設問は無効化してバックアップ問題に自動差し替え（総問数は維持）。

## 6. Success Metrics
- 体感速度（Hard Gate）：LCP（モバイルP75）、TTFS（操作→可聴P75）
- 再生の信頼性（Hard Gate）：Playback Start Rate（出題のうち実再生の割合）、System Skip Rate（全候補不可による無効差し替えの割合）
- 再生の安定性（Monitor）：Fallback Occurrence（フォールバック発生割合）
- ゲーム達成（Hard Gate）：Completion Rate（結果画面到達率）
- 進行テンポ（Monitor）：Session Duration（1プレイの中央値）
- しきい値はMVP公開時の実測に基づき設定し、一定期間後に見直す

## 7. Risks & Mitigations
**この章の目的：** MVPの失敗に直結する主要リスクを列挙し、6章の指標に基づく検知とMVPでの対策/回避を簡潔に定める（数値や運用詳細は別ドキュメントに委ねる）。

- **R1: 外部配信の再生失敗（埋め込み不可/地域/CORS/自動再生）** — 検知：Playback Start Rate↓・System Skip Rate↑。対策/回避：**複数ソース優先度＋ユーザー操作起点＋自動フォールバック**、全候補不可は**System Skip→バックアップ差替**。
- **R2: 体感速度の悪化（LCP/TTFS）** — 検知：LCP（モバイルP75）>2.5s・TTFS悪化。対策/回避：初回JS（gzip）**≤150KB**・遅延ロード・最適化、必要時**軽量モード**。
- **R3: 問題プールの陳腐化/リンク切れ** — 検知：Fallback Occurrence上振れ・差替率増。対策/回避：**バックアップ問題同梱**＋CIの埋め込み可否ヘルスチェック、影響セット一時停止→代替差替。
- **R4: 端末/ブラウザ差による音出し不可** — 検知：端末別Playback Start Rateの偏り。対策/回避：**明示的再生ボタン＋初回ガイダンス**・gesture順守・リトライ、`/play`からヘルプへ即遷移。
- **R5: 計測欠損（オフライン/ブロック/送信失敗）** — 検知：イベント到達率・セッション整合の下振れ。対策/回避：**ローカルキュー再送**・最小イベント送信・PII不収集、計測不能でもプレイ継続。
- **R6: 法務/配信規約の不整合・仕様変更** — 検知：エラー/HTTP 4xx増・外部通報。対策/回避：**公式配信のみ**・出典/禁止明記・ソース多重化、影響ソース停止→代替切替。

## 8. Open Questions
**この章の目的：** 現時点で未確定の意思決定事項を列挙し、次の合意形成に向けた論点を明確化する。

- **Q1: 計測の送信手段・頻度・再送条件** — navigator.sendBeacon / fetch / バッチ化の採用有無、送信タイミングと失敗時の再送ルール。
- **Q2: バックアップ問題の同梱比率と更新フロー** — 既定10問に対し何問をバックアップとして保持するか、差し替え時の運用。
- **Q3: 法務文言の最終形** — 出典表記・クレジット・免責・地域/年齢注意の文面と掲出場所。
- **Q4: 問題/音源データのスキーマ** — 設問ID命名、ソース候補の優先度表現、メタデータ（タイトル/シリーズ/長さ等）の最小集合。
- **Q5: 再生ソース優先順位とプロバイダ方針** — どの配信を優先するか、地域差・ブロック時の順序規則。
- **Q6: 結果画面の表示項目の確定** — 合計スコア/正解数/各問残秒/正誤の表示範囲、共有導線の有無と仕様。

