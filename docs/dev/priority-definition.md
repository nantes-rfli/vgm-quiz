# Priority定義 — Issue優先度管理ガイド

- **Status**: Approved
- **Last Updated**: 2025-10-13
- **目的**: GitHub Issue の Priority ラベル (P0/P1/P2/P3) の定義と運用方針を明確化

---

## 概要

Priority ラベルは **現在のフェーズ内** での緊急度・重要度を示します。

**重要**: Priority は「全体の優先度」ではなく、**「現フェーズ内での相対的な優先度」** です。Phase 2 の P0 が Phase 1 の P3 より重要とは限りません。

---

## Priority定義

### P0 - Blocker (ブロッカー)

**定義**: 現在のフェーズのリリースを **ブロック** する問題

**特徴**:
- デプロイ前に **必ず** 解決が必要
- これがないとフェーズの目標を達成できない
- チーム全体で最優先で取り組むべき

**例**:
- クリティカルバグ (データ損失、セキュリティ問題)
- コア機能の未実装 (Phase 1: Tokenized Round API)
- デプロイブロッカー (本番環境でクラッシュする)

**運用**:
- P0 は常に最小限 (理想は0-2個)
- P0 が複数ある場合、優先順位を明示的に議論
- 解決まで他の作業を一時停止することもある

---

### P1 - High Priority (高優先度)

**定義**: リリースにとって **重要** だが、技術的にはブロッカーではない

**特徴**:
- リリース前に解決 **すべき** (should) だが、最悪は延期可能
- ユーザー体験やプロダクト品質に大きく影響
- 時間があれば現フェーズで対応したい

**例**:
- 主要機能の改善 (#65 ランタイム型ガード)
- 重要なUX問題 (タイマー表示のバグ)
- セキュリティ強化 (型安全性、入力検証)

**運用**:
- P1 は現フェーズの主要タスク群
- 時間が足りない場合、一部を次フェーズに延期する判断もあり
- 延期する場合は明示的に理由を記録

---

### P2 - Medium Priority (中優先度)

**定義**: 現フェーズにとって **Nice to have** (あると良い)

**特徴**:
- リリース後でも対応可能
- プロダクト品質の向上やメンテナンス性の改善
- 時間がなければ次フェーズに延期

**例**:
- ドキュメント改善 (#32, #33, #35)
- マイナーな機能拡張
- モニタリング追加 (#75 Web Vitals計測)
- テスト追加 (#77 Contract Test)

**運用**:
- P2 は「余裕があれば」のタスク
- フェーズ末期に時間が余ったら着手
- 次フェーズで P1 に昇格する可能性あり

---

### P3 - Low Priority (低優先度)

**定義**: 現フェーズ終了後や運用開始後に判断すべきタスク

**特徴**:
- リリース後の運用で必要性を判断
- オプショナルな機能
- バックログ拡充や改善候補

**例**:
- オプショナルAPI (#28 Availability API)
- 運用ドキュメント (#37 レート制限/署名鍵ローテーション)
- データ拡充 (#31 バックアップ在庫追加)
- 将来機能の調査タスク

**運用**:
- P3 は「いつかやるかも」のタスク
- 次フェーズで再評価し、P2/P1 に昇格または削除
- 長期間放置されるIssueはクローズを検討

---

## フェーズ移行時の優先度再評価

### 基本原則

フェーズが変わると、優先度も変わります。

**例**:
- **Phase 1 の P2/P3** → **Phase 2 の P1** になる可能性
  - Phase 1: Manifest API (#27) は P1 だが、固定問題セット方式のため延期 → Phase 2
  - Phase 2: ユーザーフィルタ機能の前提なので P0/P1 に昇格

- **Phase 1 の P1** → **Phase 2 では不要** になる可能性
  - Phase 1 で重要だった移行タスクが、Phase 2 では完了済み

### 再評価プロセス

フェーズ移行時:

1. **Phase N の積み残し確認**
   - P1/P2/P3 で未完了のIssueをリストアップ
   - 各Issueが次フェーズでも必要か判断

2. **Phase N+1 の目標との照合**
   - 次フェーズの目標 (roadmap.md参照) に照らして優先度を再設定
   - 不要になったIssueはクローズ

3. **新規Issue作成**
   - Phase N+1 で新たに必要な機能をIssue化
   - 初期優先度を設定 (P0/P1/P2/P3)

4. **Phase N+1 開始**
   - P0/P1 を中心に作業開始
   - P2/P3 はバックログとして管理

---

## Phase と Priority の組み合わせ

### `phase:N` ラベルとの併用

Priority は「フェーズ内の優先度」、Phase ラベルは「どのフェーズで実装するか」を示します。

**例**:

| Issue | Phase Label | Priority Label | 意味 |
|-------|-------------|----------------|------|
| #27 Manifest API | `phase:2` | (なし) | Phase 2 で実装予定、Phase 2 開始時に優先度を設定 |
| #65 Type Guards | `phase:1` | `P1` | Phase 1 の高優先度タスク (現在進行中) |
| #28 Availability API | `phase:2` | (なし) | Phase 2 で実装予定、Phase 2 内では P3 の見込み |

**運用ルール**:
- **Open Issue**: 現在のフェーズのラベル + Priority設定
- **Closed Issue (延期)**: 次フェーズのラベル付与、Priority は次フェーズ開始時に設定
- **Closed Issue (完了)**: ラベルそのままクローズ

---

## Priority設定ガイドライン

### 新規Issue作成時

1. **現在のフェーズを確認** (roadmap.md参照)
2. **そのIssueが現フェーズの目標にどう関わるか判断**
   - 目標達成に必須 → P0
   - 目標達成に重要 → P1
   - あると良い → P2
   - 将来的に必要かも → P3
3. **他のIssueと相対的な優先度を比較**

### 既存Issueの優先度変更

以下の場合に優先度を変更:

- **昇格 (P2 → P1)**:
  - 外部依存の解決により、実装可能になった
  - ユーザーフィードバックで重要性が判明
  - 他機能の前提条件になった

- **降格 (P1 → P2)**:
  - 技術的課題により、現フェーズでの実装が困難
  - スコープ削減の決定
  - 代替手段が見つかった

- **P3 への降格またはクローズ**:
  - 長期間放置されている
  - プロダクトの方向性と合わなくなった
  - 別の方法で解決された

---

## よくある質問 (FAQ)

### Q1: Phase 1 の P3 と Phase 2 の P1 はどちらが重要?

**A**: 状況によります。

- **現在 Phase 1 進行中**: Phase 1 の P0/P1 を優先。Phase 2 の計画は後回し。
- **Phase 1 完了間近**: Phase 2 の P0/P1 の準備を開始しても良い。

基本的には **現フェーズ内のタスクを優先** します。

---

### Q2: P0 が多すぎる場合は?

**A**: P0 の定義が緩い可能性があります。

- 本当にリリースをブロックするか再確認
- 一部を P1 に降格
- チームで優先順位を議論

理想的には P0 は 0-2個、最大でも 3-5個程度。

---

### Q3: Issue作成から時間が経ち、優先度が不明確になった場合は?

**A**: 定期的にバックログ整理 (grooming) を実施:

1. 3ヶ月以上放置されたIssueをリストアップ
2. 各Issueの必要性を再評価
3. 優先度を更新 or クローズ

目安: フェーズ移行時に必ず実施、それ以外は月1回程度。

---

### Q4: Priority ラベルがないIssueはどうする?

**A**: 以下のケース:

- **新規Issue**: 作成者がPriorityを設定
- **Phase間の移行Issue** (#27など): 次フェーズ開始時に設定
- **バックログ/アイデア**: `phase:future` + Priority未設定でOK

運用ルール: **Open状態で現フェーズに該当するIssueには必ずPriorityを設定**

---

## 関連ドキュメント

- [Product Roadmap](roadmap.md) - Phase別の全体計画
- [Backlog Plan](backlog-plan-2025-09-28.md) - Phase 1のバックログ管理履歴
- [Product Requirements](../product/requirements.md) - プロダクト要件とスコープ

---

## 変更履歴

- **2025-10-13**: 初版作成、Phase 1 → 2 移行を踏まえた優先度管理方針を明確化
