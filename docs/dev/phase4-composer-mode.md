# Phase 4B: 作曲者モード 計画メモ（Plan フェーズ）

## ゴール
- 作曲者モードを最小実装で提供し、難易度オートチューニングの A/B 検証に活用する。

## スコープ（計画時点）
- 出題条件: composer メタが存在するトラックのみを母集団にする。
- 選択肢生成: 正解1 + 誤答3（シリーズ/年代が近い作曲者を優先）。
- UI/i18n: シンプルな1行プロンプトを追加。英語/日本語対応のみで開始。
- 計測: 完走率・再訪率・正答率・問題あたり回答時間を A/B で比較。

## 非スコープ（このフェーズではやらない）
- 恒久的パーソナライズやスコア保存。
- 作曲者以外の新モード追加。
- 本格的な ML モデル導入（ルールベースで開始）。

## 依存関係 / 前提
- composer メタが取れるデータソース（Spotify 取り込み後に精度向上見込み）。
- Manifest / availability に composer が露出していること。
- A/B 割付ロジックとメトリクス集計が Phase 3 の観測基盤で確認できること。

## UI 文言（案）
- プロンプト: 「この曲の作曲者は？」
- 正解時: 「正解！作曲者: {composer}」
- 不正解時: 「正解は {composer} でした」

## i18n キー（案）
- `quiz.composer.prompt`
- `quiz.composer.correct`
- `quiz.composer.incorrect`

## A/B 設計（案）
- Treatment: composer モード + 難易度オートチューニング ON
- Control 1: composer モード + 固定難易度
- Control 2: 既存モード（難易度オートなし）
- 主要指標: 完走率 / 再訪率 / 正答率 / 回答時間
- 成功条件: 95%信頼で完走率 or 再訪率が改善し、回答時間が悪化しない。

## 指標しきい値・サンプルサイズ（ドラフト）
- 最低検出効果 (MDE): 完走率 +3pt / 再訪率 +2pt を目安に設定
- サンプルサイズ（概算）: それぞれの群で N ≈ 5k セッション（想定ベースライン完走率 35%、α=0.05, power=0.8）
- 観測期間目安: 1〜2 週間（トラフィック量次第で再計算）

## composer メタ欠損時のフォールバック案（ドラフト）
- 欠損閾値: 対象母集団で composer 欠損率が >5% なら fallback を有効にする
- フォールバック: composer 欠損トラックはモード外へ退避（抽選対象から除外）、必要に応じてタイトル/ゲーム名をもとに補完
- ロギング: 欠損率をメトリクス化し、5%超でアラート

## 実装タスク（まだ着手しない）
- [ ] i18n キー設計を確定し、言語ファイル差分を見積もる
- [ ] サンプリング条件・選択肢生成ロジックを共有ライブラリに定義（フラグで無効化のまま）
- [ ] A/B 割付のトークン埋め込み設計
- [ ] MSW/Playwright シナリオ追加のテストケース設計
- [ ] 指標しきい値とサンプルサイズの再計算（最新トラフィックに応じて）
- [ ] composer 欠損率アラートの閾値実装案を決定

## レビュー依頼事項
- プロンプト文言、指標の妥当性、Control 群の構成
- composer メタの最小品質ライン（欠損率の許容範囲）
